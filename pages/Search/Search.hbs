<main class=search-page id=main>

  <search class=sticky>
    <form class=search-form id=search-form method=get>

      <label for=search-box>Quick Search</label>
      <input
        autocomplete=on
        autocorrect=off
        class=text-box
        enterkeyhint=search
        id=search-box
        inputmode=search
        name=q
        placeholder='e.g. “atimw-” or “dog”'
        spellcheck=false
        type=search
      >
      <span class=help-text>Searches forms (in any orthography) and definitions. Leave blank to display all components.</span>

      <div class=checkbox-field>
        <input id=case-sensitive-box name=caseSensitive type=checkbox>
        <label for=case-sensitive-box>Match case</label>
      </div>

      <div class=checkbox-field>
        <input id=diacritics-box name=diacritics type=checkbox>
        <label for=diacritics-box>Match diacritics</label>
      </div>

      <div class=checkbox-field>
        <input id=regex-box name=regex type=checkbox>
        <label for=regex-box>Use regular expressions</label>
        <a class=info-link href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_expressions target=_blank>
          <span class=visually-hidden>More information about regular expressions.</span>
          <svg aria-hidden=true class=info-icon><use href=#info></svg>
        </a>
      </div>

      <label for=language-select>Language</label>
      <select class=text-box name=language id=language-select>
        <option selected value=all>All languages</option>
        {{#each languages as |lang| }}
          <option value='{{ key }}'>{{ name }} {{#if autonyms }}({{#each autonyms }}{{ this }}{{#unless @last }}, {{/unless}}{{/each}}){{/if}}</option>
        {{/each}}
      </select>

      <div class=search-controls>
        <button class='button green' id=search-button type=submit>Search</button>
        <button class='button blue' id=reset-button type=reset>Reset</button>
      </div>

    </form>
  </search>

  {{#unless hasResults }}
    <dl class='stats sticky'>
      <dt># of languages</dt>
      <dd>{{ numLanguages }}</dd>
      <dt># of components</dt>
      <dd>{{ numComponents }}</dd>
    </dl>
  {{else}}
    {{#unless results }}
      <p class='no-results sticky'>No results found.</p>
    {{else}}

      <div class='results-info sticky'>
        <p class=num-results>Showing results {{ pagination.startIndex }}–{{ pagination.endIndex }} of {{ totalResults }}.</p>
        <p class=help-text>Click on any column header with a sort icon (⇅) to sort that column.</p>
        <p class=help-text>Click on a form to view more information about that component.</p>
        {{> help-text/help-text }}
      </div>

      {{#if pagination.show }}
        {{> Search/components/pagination/pagination }}
      {{/if}}

      <div aria-labelledby=results-caption class='results-wrapper scroll-shadow' role=region tabindex=0>

        <span class=hint id=priority-hint>Priority</span>
        <span class=hint id=sort-hint>Click on a header column to sort.</span>

        <table id=results>
          <caption class=visually-hidden id=results-caption><h2>Search Results</h2></caption>
          <thead>
            <tr class=meta-row>
              {{!-- Component Fields --}}
              <th colspan=6 scope=col>
                <span>Components</span><br><span class='help-text th-note'>(Project Orthography)</span>
              </th>
              {{!-- Token Fields --}}
              <th colspan=3 scope=col>
                <span>Sources</span><br><span class='help-text th-note'>(Original Orthographies)</span>
              </th>
            </tr>
            <tr>

              {{!-- Component Fields --}}
              {{#with sort }}
              <th {{#if displayLanguage }} aria-sort='{{ displayLanguage.direction }}' {{/if}} scope=col>
                <button aria-describedby=sort-hint class=sort-button data-field=displayLanguage>
                  <span>Language</span>
                  <svg aria-hidden class=sort-icon><use href='{{#if (is displayLanguage.direction 'ascending') }}#ascending{{else if (is displayLanguage.direction 'descending') }}#descending{{else}}#sort{{/if}}'></svg>
                </button>
                {{#if displayLanguage }}<span aria-describedby=priority-hint class=priority>{{ displayLanguage.priority }}</span>{{/if}}
              </th>
              <th {{#if form }} aria-sort='{{ form.direction }}' {{/if}} scope=col>
                <button aria-describedby=sort-hint class=sort-button data-field=form>
                  <span>Form</span>
                  <svg aria-hidden class=sort-icon><use href='{{#if (is form.direction 'ascending') }}#ascending{{else if (is form.direction 'descending') }}#descending{{else}}#sort{{/if}}'></svg>
                </button>
                {{#if form }}<span aria-describedby=priority-hint class=priority>{{ form.priority }}</span>{{/if}}
              </th>
              <th {{#if UR }} aria-sort='{{ UR.direction }}' {{/if}} scope=col>
                <button aria-describedby=sort-hint class=sort-button data-field=UR>
                  <span>UR</span>
                  <svg aria-hidden class=sort-icon><use href='{{#if (is UR.direction 'ascending') }}#ascending{{else if (is UR.direction 'descending') }}#descending{{else}}#sort{{/if}}'></svg>
                </button>
                {{#if UR }}<span aria-describedby=priority-hint class=priority>{{ UR.priority }}</span>{{/if}}
              </th>
              <th {{#if definition }} aria-sort='{{ definition.direction }}' {{/if}} scope=col>
                <button aria-describedby=sort-hint class=sort-button data-field=definition>
                  <span>Definition</span>
                  <svg aria-hidden class=sort-icon><use href='{{#if (is definition.direction 'ascending') }}#ascending{{else if (is definition.direction 'descending') }}#descending{{else}}#sort{{/if}}'></svg>
                </button>
                {{#if definition }}<span aria-describedby=priority-hint class=priority>{{ definition.priority }}</span>{{/if}}
              </th>
              <th {{#if type }} aria-sort='{{ type.direction }}' {{/if}} scope=col>
                <button aria-describedby=sort-hint class=sort-button data-field=type>
                  <span>Type</span>
                  <svg aria-hidden class=sort-icon><use href='{{#if (is type.direction 'ascending') }}#ascending{{else if (is type.direction 'descending') }}#descending{{else}}#sort{{/if}}'></svg>
                </button>
                {{#if type }}<span aria-describedby=priority-hint class=priority>{{ type.priority }}</span>{{/if}}
              </th>
              <th {{#if subcategory }} aria-sort='{{ subcategory.direction }}' {{/if}} scope=col>
                <button aria-describedby=sort-hint class=sort-button data-field=subcategory>
                  <span>Subcategory</span>
                  <svg aria-hidden class=sort-icon><use href='{{#if (is subcategory.direction 'ascending') }}#ascending{{else if (is subcategory.direction 'descending') }}#descending{{else}}#sort{{/if}}'></svg>
                </button>
                {{#if subcategory }}<span aria-describedby=priority-hint class=priority>{{ subcategory.priority }}</span>{{/if}}
              </th>
              {{/with}}

              {{!-- Token Fields --}}
              <th class=token-th scope=col>Forms</th>
              <th class=token-th scope=col>URs</th>
              <th class=token-th scope=col>Glosses</th>

            </tr>
          </thead>
          <tbody>
            {{#each results as |result| }}
              <tr id='{{ ID }}'>
                <td class=language>{{ displayLanguage }}</td>
                <td class=form>{{#if form }}<a class=link href='/components/{{ ID }}'>{{ form }}</a>{{else}}—{{/if}}</td>
                <td class=UR>{{#if UR }}<a class=link href='/components/{{ ID }}'>/{{ UR }}/</a>{{else}}—{{/if}}</td>
                <td class=definition>{{#if definition }}‘{{ definition }}’{{else}}—{{/if}}</td>
                <td class=component-type>{{#if type }}{{ type }}{{else}}—{{/if}}</td>
                <td class=subcategory>{{#if subcategory }}{{ subcategory }}{{else}}—{{/if}}</td>
                <td class=source-forms>
                  <ul>
                    {{#each tokens as |token| }}
                      <li>{{#if form }}{{ form }}{{else}}—{{/if}}</li>
                    {{/each}}
                  </ul>
                </td>
                <td class=source-URs>
                  <ul>
                    {{#each tokens as |token| }}
                      <li>{{#if UR }}/{{ UR }}/{{else}}—{{/if}}</li>
                    {{/each}}
                  </ul>
                </td>
                <td class=source-glosses>
                  <ul>
                    {{#each tokens as |token| }}
                      <li>{{#if gloss }}‘{{ gloss }}’{{else}}—{{/if}}</li>
                    {{/each}}
                  </ul>
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      {{#if pagination.show }}
        {{> Search/components/pagination/pagination }}
      {{/if}}

      <section class='citation sticky'>

        <h2>How to Cite these Results</h2>

        <blockquote class=blockquote data-hook=citation><p>Monica Macaulay, Hunter T. Lockwood, &amp; Daniel W. Hieber. {{ meta.releaseYear }}. <cite>Nisinoon: The Algonquian Components Database</cite> v{{ package.version}}. DOI: <a class=link href=https://doi.org/10.5281/zenodo.11459862>10.5281/zenodo.11459862</a>. URL: <a class=link href='https://nisinoon.net{{ url }}'>https://nisinoon.net{{ url }}</a>.</p></blockquote>

        <button class='button copy-button' data-hook=copy-citation type=button>Copy</button>

      </section>

    {{/unless}}
  {{/unless}}

</main>

{{#section 'scripts'}}
  <script async type=module>{{{ js.Search }}}</script>
{{/section}}